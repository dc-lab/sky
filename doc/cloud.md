## Cloud description

Основная задача сервиса Cloud: инкапсулировать логику взаимодействия с облачными сервисами, чтобы ResourceManager мог взаимодействовать с ними как с еще одним типом ресурсов.

Пользователь может указать в профиле SKY данные своего аккаунта во внешних системах (credentials -- например, пару key id и secret value) с выделенными правами на некоторые действия (AllocateInstance / StartInstance / DeployImage) и квоту на использование ресурсов. При запуске задачи пользователь может запросить использование облачных ресурсов в пределах квоты, указанной в настройках аккаунта. При исполнении задачи ResourceManager может запросить выделение или переиспользование облачных ресурсов пользователя.

В первом приближении потребление пользовательских ресурсов не квотируется.

Имеет смысл запускать Cloud на одном физическом хосте с ResourceManager (возможно в разных контейнерах, используя коллокацию) для уменьшения сетевого взаимодействия.

## WorkFlow

При подключении облачного контейнера Cloud присваивает ему UUID, с помощью которого переданным в управление контейнером можно управлять. В первом приближении UUID контейнеров хранится в оперативной памяти инстанса Cloud. Позднее будет необходимо заиспользовать хранилище данных, способное переживать рестарты сервиса.

Cloud принимает контейнер в пользование с запросом подключения инстанса к системе (ConnectInstanceRequest). Сервис может предварительно выделить ресурсы под инстанс (AllocateInstanceRequest). Для передачи ресурса в пользование ResourceManager'у необходимо задеплоить предварительно загруженный в docker-репозиторий образ с агентом и запустить выделенный инстанс (DeployImageRequest). При успешном деплое агент откроет grpc-соединение с ResourceManager'ом. Cloud не следит за живостью агента на выделенном ресурсе. Предполагается, что этим должен заниматься ResourceManager.

При необходимости (например, при выкладке новой версии образа или если инстанс долгое время не используется) можно направить в Cloud запрос об остановке инстанса (StopInstanceRequest).

Если использовать инстанс больше не предполагается, Cloud может отключить инстанс от системы (DisconnectInstanceRequest) или удалить ранее выделенные под инстанс ресурсы (DeallocateInstanceRequest).

